   1:				;
   2:				; NISTBLOK
   3:				;
   4:				; THIS IS AN EXAMPLE OF USING TRSNIC WITH A SIMPLE BLOCKING 
   5:				; TCP/IP SERVICE LISTENING USING IP ADDRESS AND PORT
   6:				;
   7:				;
   8:				
   9:				*INCLUDE TRSNIC
**** TRSNIC.asm ****
   1:     -	0001'         		IFNDEF	NIC_ASM
   2:				
   3:					EXT	NICINIT
   4:					EXT	NICSEND
   5:					EXT	NICRECV
   6:					EXT	NICCLOS
   7:				
   8:					ENDIF
   9:				
  10:     -	0000'         		END
**** nistblok.asm ****
  10:				
  11:				;CONNECT TO THE NIST TIME SERVER
  12:				;time-a-wwv.nist.gov	132.163.97.1	WWV, Fort Collins, Colorado
  13:				
  14:     -	0084'         	DESTIP1		EQU	132		; BYTE 1 OF IP ADDR TO CONNECT
  15:     -	00A3'         	DESTIP2		EQU	163		; BYTE 2 OF IP ADDR TO CONNECT
  16:     -	0061'         	DESTIP3		EQU	97		; BYTE 3 OF IP ADDR TO CONNECT
  17:     -	0001'         	DESTIP4		EQU	1			; BYTE 4 OF IP ADDR TO CONNECT
  18:     -	000D'         	DESTPORT	EQU	13		; TCP PORT TO CONNECT
  19:				
  20:     -	0000'         	START::	EQU	$
  21:				
  22:    0+10	0000' 110D00  		LD	DE,DESTPORT	;THE DESTINATION PORT
  23:   10+7	0003' 2684    		LD	H,DESTIP1		;FIRST BYTE OF DEST IP
  24:   17+7	0005' 2EA3    		LD	L,DESTIP2		;SECOND BYTE OF DEST IP
  25:   24+7	0007' 0661    		LD	B,DESTIP3		;THIRD BYTE OF DEST IP
  26:   31+7	0009' 0E01    		LD	C,DESTIP4		;FOURTH BYTE OF DEST IP
  27:				
  28:   38+17	000B' CD0000  		CALL NICINIT		;INITIALIZE TRSNIC
  29:				
  30:				;SET UP FOR RECV
  31:				
  32:   55+10	000E' 212800  		LD	HL,RESBUF	;THE RECV BUFFER IN HL
  33:   65+10	0011' 010000  		LD	BC,0			;MAX 64K BUFFER SO TOP 2 MSB LEN BYTES ARE ZERO
  34:   75+10	0014' 113300  		LD	DE,RESLEN	;2 LSB ARE THE BUFFER SIZE
  35:   85+7	0017' 3E00    		LD	A,0				;USE BLOCKING
  36:   92+17	0019' CD0000  		CALL	NICRECV
  37:				
  38:  109+10	001C' 212800  		LD	HL,RESBUF	;HL NOW HAS THE RESPONSE BUFFER
  39:				
  40:				;BCDE HAS THE RESPONSE LENGTH (WE IGNORE 2 UPPER MSB IN BC)
  41:				
  42:				;DO SOMETHING WITH RESPONSE
  43:				
  44:  119+17	001F' CD6744  		CALL	4467H		;PRINT OUT RESPONSE
  45:				
  46:				;CLOSE THE SOCKET
  47:				
  48:  136+17	0022' CD0000  		CALL NICCLOS
  49:				
  50:  153+10	0025' C33040  		JP	4030H			;EXIT
  51:				
  52:     -	0028'         	RESBUF	DS	51		;51 BYTE RESPONSE BUFFER
  53:     -	005B' 0D      					DB	13		;ADD A CR AT END OF RESPONSE
  54:     -	0033'         	RESLEN	EQU	51



Statistics:

     4	passes
     0	jr promotions
    12	symbols
    41	bytes



Symbol Table:

destip1        =  84     
destip2        =  a3     
destip3        =  61     
destip4        =   1     
destport       =   d     
nicclos            0      (extern)
nicinit            0      (extern)
nicrecv            0      (extern)
nicsend            0      (extern)
resbuf            28'    
reslen         =  33     
start          =   0'     (public)
